- content_for :page_title, '固定ページ管理'

.navigation-settings-section
  %h3 ナビゲーションメニュー設定
  %p.description 以下の3つのページがサイトのナビゲーションメニューに表示されます（ドラッグで順序を変更可能）
  
  = form_with url: update_navigation_admin_pages_path, method: :patch, local: true, id: 'navigation-form' do |form|
    .navigation-slots
      - (1..3).each do |position|
        - current_page = @navigation_pages[position - 1]
        .navigation-slot{data: {position: position}}
          %h4= "位置 #{position}"
          .current-selection
            - if current_page
              .selected-page
                %span.page-title= current_page.title
                %span.page-status{class: "status-#{current_page.status}"}= current_page.status == 'published' ? '公開' : '下書き'
                = link_to '削除', '#', class: 'remove-nav-page btn btn-sm btn-outline-danger', data: {position: position}
            - else
              %span.empty-slot 未設定
          
          = form.select "navigation_page_#{position}", 
            options_from_collection_for_select(@available_pages, :id, :title, current_page&.id),
            { prompt: 'ページを選択してください', include_blank: true },
            { class: 'form-control page-selector', data: { position: position } }
    
    .navigation-actions
      = form.submit 'ナビゲーション設定を更新', class: 'btn btn-success'
      = link_to 'リセット', admin_pages_path, class: 'btn btn-secondary'

.admin-content-actions
  = link_to '新規ページ作成', new_admin_page_path, class: 'btn btn-primary'

.admin-table-container
  %table.admin-table
    %thead
      %tr
        %th.checkbox-column
          %input{type: 'checkbox', id: 'select-all-pages'}
        %th.title-column タイトル
        %th.slug-column スラッグ
        %th.status-column ステータス
        %th.author-column 作成者
        %th.date-column 作成日
        %th.date-column 更新日
        %th.actions-column 操作

    %tbody
      - if @pages.any?
        - @pages.each do |page|
          %tr.page-row{data: {id: page.id}}
            %td.checkbox-column
              %input{type: 'checkbox', name: 'page_ids[]', value: page.id}
            %td.title-column
              .page-title-wrap
                = link_to admin_page_path(page), class: 'page-title-link' do
                  %strong= page.title
                - if page.meta_description.present?
                  %p.page-excerpt= truncate(page.meta_description, length: 80)
            %td.slug-column
              %code.slug-code= "/#{page.slug}"
            %td.status-column
              %span.status-badge{class: "status-#{page.status}"}
                = page.status == 'published' ? '公開' : '下書き'
            %td.author-column 管理者
            %td.date-column
              .date-info
                %time= page.created_at.strftime('%Y/%m/%d')
                %span.time= page.created_at.strftime('%H:%M')
            %td.date-column
              .date-info
                %time= page.updated_at.strftime('%Y/%m/%d')
                %span.time= page.updated_at.strftime('%H:%M')
            %td.actions-column
              .action-buttons
                = link_to '編集', edit_admin_page_path(page), class: 'btn btn-sm btn-secondary'
                = link_to '表示', admin_page_path(page), class: 'btn btn-sm btn-info'
                = link_to '削除', admin_page_path(page), method: :delete, 
                          data: { confirm: '本当に削除しますか？' }, class: 'btn btn-sm btn-danger'
      - else
        %tr.no-items
          %td{colspan: 8}
            .no-items-message
              %i.icon.icon-page
              %p まだ固定ページがありません
              = link_to '最初のページを作成', new_admin_page_path, class: 'btn btn-primary'

.admin-table-footer
  .bulk-actions
    %select.bulk-action-select{disabled: true}
      %option{value: ''} 一括操作を選択
      %option{value: 'publish'} 公開
      %option{value: 'draft'} 下書きに戻す
      %option{value: 'delete'} 削除
    %button.btn.btn-secondary.bulk-action-btn{disabled: true} 実行

  .pagination-info
    = "#{@pages.count}件のページ"

.page-list-styles
  :css
    .admin-content-actions {
      margin-bottom: 20px;
      text-align: right;
    }

    .admin-table-container {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .admin-table {
      width: 100%;
      border-collapse: collapse;
    }

    .admin-table th {
      background: #f8f9fa;
      padding: 12px;
      font-weight: 600;
      border-bottom: 2px solid #dee2e6;
      text-align: left;
    }

    .admin-table td {
      padding: 12px;
      border-bottom: 1px solid #dee2e6;
      vertical-align: top;
    }

    .checkbox-column { width: 40px; }
    .title-column { width: 25%; }
    .slug-column { width: 20%; }
    .status-column { width: 80px; }
    .template-column { width: 100px; }
    .date-column { width: 110px; }
    .actions-column { width: 160px; }

    .page-title-link {
      text-decoration: none;
      color: #007bff;
    }

    .page-title-link:hover {
      color: #0056b3;
    }

    .page-excerpt {
      margin: 4px 0 0 0;
      font-size: 13px;
      color: #666;
      line-height: 1.4;
    }

    .slug-code {
      background: #f8f9fa;
      padding: 2px 4px;
      border-radius: 3px;
      font-family: monospace;
      font-size: 12px;
      color: #495057;
    }

    .status-badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-published {
      background: #d4edda;
      color: #155724;
    }

    .status-draft {
      background: #fff3cd;
      color: #856404;
    }

    .template-name {
      background: #e9ecef;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 12px;
      font-family: monospace;
    }

    .date-info {
      font-size: 13px;
    }

    .date-info .time {
      display: block;
      color: #666;
      font-size: 11px;
    }

    .action-buttons {
      display: flex;
      gap: 4px;
    }

    .btn-sm {
      padding: 4px 8px;
      font-size: 12px;
    }

    .no-items {
      text-align: center;
      padding: 40px 20px;
    }

    .no-items-message {
      color: #666;
    }

    .no-items-message i {
      font-size: 48px;
      color: #ccc;
      margin-bottom: 16px;
    }

    .admin-table-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      background: #f8f9fa;
      border-top: 1px solid #dee2e6;
    }

    .bulk-actions select {
      margin-right: 8px;
    }

    .pagination-info {
      color: #666;
      font-size: 14px;
    }
- content_for :title, 'æ±‚äººå¿œå‹Ÿç®¡ç†'

.admin-content-header
  %h1.admin-title æ±‚äººå¿œå‹Ÿç®¡ç†
  %p.admin-subtitle å¿œå‹Ÿè€…ã®æƒ…å ±ã‚’ç¢ºèªã—ã€é¸è€ƒçŠ¶æ³ã‚’ç®¡ç†ã§ãã¾ã™

.admin-actions
  .filter-section
    = form_with url: admin_job_applications_path, method: :get, local: true, class: 'filter-form' do |f|
      .filter-group
        = f.label :status, 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', class: 'filter-label'
        = f.select :status, options_for_select([['ã™ã¹ã¦', ''], ['å¿œå‹Ÿæ¸ˆã¿', 'submitted'], ['é¸è€ƒä¸­', 'reviewing'], ['é¢æ¥äºˆå®š', 'interview'], ['æ¡ç”¨æ±ºå®š', 'accepted'], ['ä¸æ¡ç”¨', 'rejected']], params[:status]), {}, { class: 'form-control filter-select' }
      
      .filter-group
        = f.label :job_id, 'æ±‚äºº', class: 'filter-label'
        = f.select :job_id, options_from_collection_for_select(@jobs, :id, :title, params[:job_id]), { prompt: 'ã™ã¹ã¦ã®æ±‚äºº' }, { class: 'form-control filter-select' }
      
      .filter-actions
        = f.submit 'ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼', class: 'btn btn-primary'
        = link_to 'æ¡ä»¶ã‚’ã‚¯ãƒªã‚¢', admin_job_applications_path, class: 'btn btn-outline-secondary'

.status-summary
  %h3 å¿œå‹ŸçŠ¶æ³ã‚µãƒãƒªãƒ¼
  .status-cards
    - JobApplication.statuses.each do |key, value|
      .status-card{class: "status-#{key}"}
        .status-count= @status_counts[key] || 0
        .status-label= JobApplication.new.tap{|ja| ja.status = key}.status_display

.admin-table-container
  - if @job_applications.any?
    %table.admin-table
      %thead
        %tr
          %th ID
          %th æ±‚äºº
          %th å¿œå‹Ÿè€…å
          %th ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
          %th çµŒé¨“å¹´æ•°
          %th ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
          %th å¿œå‹Ÿæ—¥æ™‚
          %th æ“ä½œ
      %tbody
        - @job_applications.each do |application|
          %tr
            %td= application.id
            %td
              = link_to application.job.title, admin_job_path(application.job), class: 'job-link'
              %br
              %small.text-muted= application.job.job_type
            %td
              %strong= application.name
              %br
              %small.text-muted= application.phone
            %td
              = link_to application.email, "mailto:#{application.email}", class: 'email-link'
            %td
              #{application.experience_years}å¹´
            %td
              %span.badge{class: "badge-#{application.status_color}"}
                = application.status_display
            %td
              = application.created_at.strftime('%Y/%m/%d %H:%M')
            %td.table-actions
              = link_to 'è©³ç´°', admin_job_application_path(application), class: 'btn btn-sm btn-outline-primary'
              .dropdown
                %button.btn.btn-sm.btn-secondary.dropdown-toggle{type: 'button', 'data-bs-toggle': 'dropdown', 'aria-expanded': 'false'}
                  %span.badge{class: "badge-#{application.status_color}"}
                    = application.status_display
                  %span.dropdown-arrow â–¼
                .dropdown-menu
                  - JobApplication.statuses.each do |key, value|
                    - status_obj = JobApplication.new.tap{|ja| ja.status = key}
                    - next if key == application.status
                    = form_with url: update_status_admin_job_application_path(application), method: :patch, local: true, class: 'status-form' do |f|
                      = f.hidden_field :status, value: key
                      = f.button type: :submit, class: 'dropdown-item', data: { confirm: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã€Œ#{status_obj.status_display}ã€ã«å¤‰æ›´ã—ã¾ã™ã‹ï¼Ÿ" } do
                        %span.badge{class: "badge-#{status_obj.status_color}"}
                          = status_obj.status_display
              = link_to admin_job_application_path(application), method: :delete, 
                data: { confirm: 'æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ' }, class: 'btn btn-sm btn-outline-danger' do
                ğŸ—‘ï¸ å‰Šé™¤

  - else
    .empty-state
      .empty-icon ğŸ“
      %h3 å¿œå‹ŸãŒã‚ã‚Šã¾ã›ã‚“
      %p ã¾ã æ±‚äººã¸ã®å¿œå‹ŸãŒã‚ã‚Šã¾ã›ã‚“ã€‚

- if @job_applications.respond_to?(:current_page)
  .admin-pagination
    = paginate @job_applications
- content_for :page_title, '記事管理'


.admin-articles-index
  .d-flex.justify-content-between.align-items-center.mb-3
    -# %h1.mb-0 記事管理
    = link_to '新規記事作成', new_admin_article_path, class: 'btn btn-primary'

  = form_with url: bulk_action_admin_articles_path, method: :patch, local: true, id: 'bulk-action-form', authenticity_token: true do |form|
    = hidden_field_tag 'authenticity_token', form_authenticity_token
    = hidden_field_tag '_method', 'patch'
    .admin-table-container
      %table.admin-table
        %thead
          %tr
            %th.checkbox-column
              %input{type: 'checkbox', id: 'select-all'}
            %th.title-column タイトル
            %th.status-column ステータス
            %th.category-column カテゴリ
            %th.author-column 作成者
            %th.date-column 作成日
            %th.date-column 更新日
            %th.actions-column 操作
        %tbody
          - if @articles.any?
            - @articles.each do |article|
              %tr.article-row{data: {id: article.id}}
                %td.checkbox-column
                  %input.item-checkbox{type: 'checkbox', name: 'article_ids[]', value: article.id}
                %td.title-column
                  .article-title-wrap
                    = link_to admin_article_path(article), class: 'article-title-link' do
                      %strong= article.title
                    - if article.meta_description.present?
                      %p.article-excerpt= truncate(article.meta_description, length: 80)
                %td.status-column
                  %span.status-badge{class: "status-#{article.status}"}
                    - case article.status
                    - when 'published'
                      公開
                    - when 'limited'
                      限定公開
                    - else
                      下書き
                %td.category-column
                  - if article.custom_fields && article.custom_fields['category'].present?
                    %span.category-tag= article.custom_fields['category']
                  - else
                    %span.no-category 未分類
                %td.author-column 管理者
                %td.date-column
                  .date-info
                    %time= article.created_at.strftime('%Y/%m/%d')
                    %span.time= article.created_at.strftime('%H:%M')
                %td.date-column
                  .date-info
                    %time= article.updated_at.strftime('%Y/%m/%d')
                    %span.time= article.updated_at.strftime('%H:%M')
                %td.actions-column
                  .action-buttons
                    = link_to '編集', edit_admin_article_path(article), class: 'btn btn-sm btn-secondary'
                    = link_to '表示', admin_article_path(article), class: 'btn btn-sm btn-info'
                    = link_to '削除', admin_article_path(article),
                      data: { turbo_method: :delete, article_title: article.title, confirm: "記事『#{article.title}』を削除しますか？この操作は取り消せません。" },
                      method: :delete,
                      class: 'btn btn-sm btn-danger delete-article-btn'
          - else
            %tr.no-items
              %td{colspan: 8}
                .no-items-message
                  %i.icon.icon-article
                  %p まだ記事がありません
                  = link_to '最初の記事を作成', new_admin_article_path, class: 'btn btn-primary'


      .admin-table-footer
        .bulk-actions
          %select{name: 'bulk_action', required: true, id: 'bulk-action-select'}
            %option{value: ''} 一括操作を選択
            %option{value: 'published'} 公開
            %option{value: 'draft'} 下書きに戻す
            %option{value: 'limited'} 限定公開化
            %option{value: 'delete'} 削除
          = form.submit '実行', class: 'btn btn-secondary bulk-action-btn', id: 'bulk-action-button', onclick: "return confirm('選択した記事に対して一括操作を実行しますか？');"

    .pagination-info
      = "#{@articles.count}件の記事"


.article-list-styles
  :css
    .admin-content-actions {
      margin-bottom: 20px;
      text-align: right;
    }
    
    .bulk-actions {
      margin-bottom: 15px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 4px;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .selected-info {
      color: #495057;
      font-size: 14px;
    }

    .admin-table-container {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .admin-table {
      width: 100%;
      border-collapse: collapse;
    }

    .admin-table th {
      background: #f8f9fa;
      padding: 12px;
      font-weight: 600;
      border-bottom: 2px solid #dee2e6;
      text-align: left;
    }

    .admin-table td {
      padding: 12px;
      border-bottom: 1px solid #dee2e6;
      vertical-align: top;
    }

    .checkbox-column { width: 40px; }
    .title-column { width: 30%; }
    .status-column { width: 80px; }
    .category-column { width: 100px; }
    .author-column { width: 80px; }
    .date-column { width: 110px; }
    .actions-column { width: 160px; }

    .article-title-link {
      text-decoration: none;
      color: #007bff;
    }

    .article-title-link:hover {
      color: #0056b3;
    }

    .article-excerpt {
      margin: 4px 0 0 0;
      font-size: 13px;
      color: #666;
      line-height: 1.4;
    }

    .status-badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-published {
      background: #d4edda;
      color: #155724;
    }

    .status-draft {
      background: #ffc107;
      color: #212529;
    }
    
    .status-limited {
      background: #ff9800;
      color: white;
    }
    .category-tag {
      background: #e9ecef;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 12px;
    }

    .no-category {
      color: #999;
      font-style: italic;
      font-size: 12px;
    }

    .date-info {
      font-size: 13px;
    }

    .date-info .time {
      display: block;
      color: #666;
      font-size: 11px;
    }

    .action-buttons {
      display: flex;
      gap: 4px;
    }

    .btn-sm {
      padding: 4px 8px;
      font-size: 12px;
    }

    .no-items {
      text-align: center;
      padding: 40px 20px;
    }

    .no-items-message {
      color: #666;
    }

    .no-items-message i {
      font-size: 48px;
      color: #ccc;
      margin-bottom: 16px;
    }

    .admin-table-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      background: #f8f9fa;
      border-top: 1px solid #dee2e6;
    }

    .bulk-actions select {
      margin-right: 8px;
    }

    .pagination-info {
        color: #666;
        font-size: 14px;
      }
  -# development-only CSRF debug panel removed

  
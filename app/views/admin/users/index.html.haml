- content_for :page_title, 'ユーザー管理'

.admin-content-actions
  .user-stats
    .stat-item
      %span.stat-number= @total_users
      %span.stat-label 総ユーザー数
    .stat-item
      %span.stat-number= @recent_users
      %span.stat-label 新規ユーザー（7日間）

.admin-table-container
  %table.admin-table
    %thead
      %tr
        %th.checkbox-column
          %input{type: 'checkbox', id: 'select-all-users'}
        %th.email-column メールアドレス
        %th.name-column 名前
        %th.role-column 権限
        %th.status-column ステータス
        %th.login-column 最終ログイン
        %th.date-column 登録日
        %th.actions-column 操作

    %tbody
      - if @users.any?
        - @users.each do |user|
          %tr.user-row{data: {id: user.id}, class: (user == current_user ? 'current-user' : '')}
            %td.checkbox-column
              - unless user == current_user
                %input{type: 'checkbox', name: 'user_ids[]', value: user.id}
            %td.email-column
              .user-info
                = link_to admin_user_path(user), class: 'user-email-link' do
                  %strong= user.email
                - if user == current_user
                  %span.current-user-badge あなた
            %td.name-column
              .user-name
                - if user.first_name.present? || user.last_name.present?
                  = "#{user.first_name} #{user.last_name}".strip
                - else
                  %span.no-name 未設定
            %td.role-column
              %span.role-badge{class: "role-#{user.role || 'user'}"}
                = user.role&.capitalize || 'User'
            %td.status-column
              %span.status-badge.status-active 有効
            %td.login-column
              .login-info
                - if user.trackable_enabled? && user.last_sign_in_at
                  %time= user.last_sign_in_at.strftime('%Y/%m/%d')
                  %span.time= user.last_sign_in_at.strftime('%H:%M')
                - else
                  %span.no-login 未ログイン
            %td.date-column
              .date-info
                %time= user.created_at.strftime('%Y/%m/%d')
                %span.time= user.created_at.strftime('%H:%M')
            %td.actions-column
              .action-buttons
                = link_to '詳細', admin_user_path(user), class: 'btn btn-sm btn-info'
                = link_to '編集', edit_admin_user_path(user), class: 'btn btn-sm btn-secondary'
                - unless user == current_user
                  = link_to '削除', admin_user_path(user), method: :delete, 
                            data: { confirm: '本当に削除しますか？' }, class: 'btn btn-sm btn-danger'
      - else
        %tr.no-items
          %td{colspan: 8}
            .no-items-message
              %i.icon.icon-users
              %p ユーザーがいません

.admin-table-footer
  .bulk-actions
    %select.bulk-action-select{disabled: true}
      %option{value: ''} 一括操作を選択
      %option{value: 'activate'} 有効化
      %option{value: 'deactivate'} 無効化
      %option{value: 'delete'} 削除
    %button.btn.btn-secondary.bulk-action-btn{disabled: true} 実行

  .pagination-info
    = "#{@users.count}人のユーザー"

.user-list-styles
  :css
    .admin-content-actions {
      margin-bottom: 20px;
    }

    .user-stats {
      display: flex;
      gap: 30px;
      margin-bottom: 20px;
    }

    .stat-item {
      text-align: center;
    }

    .stat-number {
      display: block;
      font-size: 24px;
      font-weight: bold;
      color: #007bff;
    }

    .stat-label {
      display: block;
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }

    .admin-table-container {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .admin-table {
      width: 100%;
      border-collapse: collapse;
    }

    .admin-table th {
      background: #f8f9fa;
      padding: 12px;
      font-weight: 600;
      border-bottom: 2px solid #dee2e6;
      text-align: left;
    }

    .admin-table td {
      padding: 12px;
      border-bottom: 1px solid #dee2e6;
      vertical-align: top;
    }

    .checkbox-column { width: 40px; }
    .email-column { width: 25%; }
    .name-column { width: 15%; }
    .role-column { width: 80px; }
    .status-column { width: 80px; }
    .login-column { width: 110px; }
    .date-column { width: 110px; }
    .actions-column { width: 160px; }

    .current-user {
      background-color: #f8f9fa;
    }

    .user-email-link {
      text-decoration: none;
      color: #007bff;
    }

    .user-email-link:hover {
      color: #0056b3;
    }

    .current-user-badge {
      background: #007bff;
      color: white;
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 10px;
      margin-left: 8px;
    }

    .no-name {
      color: #999;
      font-style: italic;
      font-size: 12px;
    }

    .role-badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
    }

    .role-admin {
      background: #dc3545;
      color: white;
    }

    .role-editor {
      background: #ffc107;
      color: #212529;
    }

    .role-user {
      background: #e9ecef;
      color: #495057;
    }

    .status-badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-active {
      background: #d4edda;
      color: #155724;
    }

    .no-login {
      color: #999;
      font-style: italic;
      font-size: 12px;
    }

    .date-info {
      font-size: 13px;
    }

    .date-info .time {
      display: block;
      color: #666;
      font-size: 11px;
    }

    .login-info {
      font-size: 13px;
    }

    .login-info .time {
      display: block;
      color: #666;
      font-size: 11px;
    }

    .action-buttons {
      display: flex;
      gap: 4px;
    }

    .btn-sm {
      padding: 4px 8px;
      font-size: 12px;
    }

    .no-items {
      text-align: center;
      padding: 40px 20px;
    }

    .no-items-message {
      color: #666;
    }

    .no-items-message i {
      font-size: 48px;
      color: #ccc;
      margin-bottom: 16px;
    }

    .admin-table-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      background: #f8f9fa;
      border-top: 1px solid #dee2e6;
    }

    .bulk-actions select {
      margin-right: 8px;
    }

    .pagination-info {
      color: #666;
      font-size: 14px;
    }
- content_for :title, @article.title

%article.article-detail
  .container
    .article-layout
      .main-content        
        - if article_featured_image_url(@article)
          .article-featured-image-top
            = article_featured_image_tag(@article, class: 'featured-image top-featured-image')
        
        .article-header
          %h1.article-title= @article.title
          - if @article.status == 'limited'
            .limited-access-badge
              %i.icon-lock
              %span ÈôêÂÆöÂÖ¨ÈñãË®ò‰∫ã
          .article-meta
            %time.article-date= @article.published_at&.strftime('%YÂπ¥%mÊúà%dÊó•')
            %span.article-author= @article.user.first_name.present? ? "#{@article.user.first_name} #{@article.user.last_name}" : @article.user.email
          
          .article-taxonomy
            - if @article.categories.any?
              .article-category-section
                %span.article-category-label „Ç´„ÉÜ„Ç¥„É™„ÉºÔºö
                - @article.categories.each do |category|
                  = link_to category.name, site_articles_path(category: category.name), class: 'article-category'
            - if @article.tags.any?
              .article-tags-section
                %span.article-tags-label „Çø„Ç∞Ôºö
                - @article.tags.each do |tag|
                  = link_to tag.name, site_articles_path(tag: tag.name), class: 'article-tag'

        .article-content
          - if @article.show_table_of_contents
            - toc_data = generate_table_of_contents(@article.content_json)
            - if toc_data
              = toc_data[:toc]
              .article-body
                = raw toc_data[:content]
            - else
              .article-body
                - if @article.content_json.is_a?(String)
                  = raw @article.content_json
                - elsif @article.content_json.is_a?(Hash)
                  = raw @article.content_json.dig('content')
                - else
                  %p= @article.meta_description
          - else
            .article-body
              - if @article.content_json.is_a?(String)
                = raw @article.content_json
              - elsif @article.content_json.is_a?(Hash)
                = raw @article.content_json.dig('content')
              - else
                %p= @article.meta_description

      .sidebar
        = render 'shared/sidebar'

  .article-navigation
    .container
      = link_to 'Ë®ò‰∫ã‰∏ÄË¶ß„Å´Êàª„Çã', site_articles_path, class: 'btn btn-secondary'

:css
  .limited-access-badge {
    display: inline-flex;
    align-items: center;
    background: #ff9800;
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 15px;
    box-shadow: 0 2px 4px rgba(255, 152, 0, 0.3);
  }
  
  .limited-access-badge .icon-lock::before {
    content: 'üîí';
    margin-right: 6px;
    font-size: 12px;
  }
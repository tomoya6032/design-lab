// @cropper/element-viewer@2.1.0 downloaded from https://ga.jspm.io/npm:@cropper/element-viewer@2.1.0/dist/element-viewer.esm.raw.js

import e from"@cropper/element";import{getRootDocument as t,CROPPER_SELECTION as s,isElement as i,on as o,EVENT_CHANGE as n,CROPPER_CANVAS as a,CROPPER_IMAGE as r,EVENT_LOAD as h,EVENT_TRANSFORM as c,off as l,CROPPER_VIEWER as $}from"@cropper/utils";var g=":host{display:block;height:100%;overflow:hidden;position:relative;width:100%}";const d=new WeakMap;const u=new WeakMap;const m=new WeakMap;const f=new WeakMap;const S="both";const p="horizontal";const I="vertical";const b="none";class CropperViewer extends e{constructor(){super(...arguments);this.$onSelectionChange=null;this.$onSourceImageLoad=null;this.$onSourceImageTransform=null;this.$scale=1;this.$style=g;this.resize=I;this.selection="";this.slottable=false}set $image(e){u.set(this,e)}get $image(){return u.get(this)}set $sourceImage(e){f.set(this,e)}get $sourceImage(){return f.get(this)}set $canvas(e){d.set(this,e)}get $canvas(){return d.get(this)}set $selection(e){m.set(this,e)}get $selection(){return m.get(this)}static get observedAttributes(){return super.observedAttributes.concat(["resize","selection"])}connectedCallback(){var e,l;super.connectedCallback();let $=null;$=this.selection?(l=(e=t(this))===null||e===void 0?void 0:e.querySelector(this.selection))!==null&&l!==void 0?l:null:this.closest(this.$getTagNameOf(s));if(i($)){this.$selection=$;this.$onSelectionChange=this.$handleSelectionChange.bind(this);o($,n,this.$onSelectionChange);const e=$.closest(this.$getTagNameOf(a));if(e){this.$canvas=e;const t=e.querySelector(this.$getTagNameOf(r));if(t){this.$sourceImage=t;this.$image=t.cloneNode(true);this.$getShadowRoot().appendChild(this.$image);this.$onSourceImageLoad=this.$handleSourceImageLoad.bind(this);this.$onSourceImageTransform=this.$handleSourceImageTransform.bind(this);o(t.$image,h,this.$onSourceImageLoad);o(t,c,this.$onSourceImageTransform)}}this.$render()}}disconnectedCallback(){const{$selection:e,$sourceImage:t}=this;if(e&&this.$onSelectionChange){l(e,n,this.$onSelectionChange);this.$onSelectionChange=null}if(t&&this.$onSourceImageLoad){l(t.$image,h,this.$onSourceImageLoad);this.$onSourceImageLoad=null}if(t&&this.$onSourceImageTransform){l(t,c,this.$onSourceImageTransform);this.$onSourceImageTransform=null}super.disconnectedCallback()}$handleSelectionChange(e){this.$render(e.defaultPrevented?this.$selection:e.detail)}$handleSourceImageLoad(){const{$image:e,$sourceImage:t}=this;const s=e.getAttribute("src");const i=t.getAttribute("src");if(i&&i!==s){e.setAttribute("src",i);e.$ready((()=>{this.$render()}))}}$handleSourceImageTransform(e){this.$render(void 0,e.detail.matrix)}$render(e,t){const{$canvas:s,$selection:i}=this;e||i.hidden||(e=i);(!e||e.x===0&&e.y===0&&e.width===0&&e.height===0)&&(e={x:0,y:0,width:s.offsetWidth,height:s.offsetHeight});const{x:o,y:n,width:a,height:r}=e;const h={};const{clientWidth:c,clientHeight:l}=this;let $=c;let g=l;let d=NaN;switch(this.resize){case S:d=1;$=a;g=r;h.width=a;h.height=r;break;case p:d=r>0?l/r:0;$=a*d;h.width=$;break;case I:d=a>0?c/a:0;g=r*d;h.height=g;break;case b:default:c>0?d=a>0?c/a:0:l>0&&(d=r>0?l/r:0)}this.$scale=d;this.$setStyles(h);this.$sourceImage&&setTimeout((()=>{this.$transformImageByOffset(t!==null&&t!==void 0?t:this.$sourceImage.$getTransform(),-o,-n)}))}$transformImageByOffset(e,t,s){const{$image:i,$scale:o,$sourceImage:n}=this;if(n&&i&&o>=0){const[n,a,r,h,c,l]=e;const $=(t*h-r*s)/(n*h-r*a);const g=(s*n-a*t)/(n*h-r*a);const d=n*$+r*g+c;const u=a*$+h*g+l;i.$ready((e=>{this.$setStyles.call(i,{width:e.naturalWidth*o,height:e.naturalHeight*o})}));i.$setTransform(n,a,r,h,d*o,u*o)}}}CropperViewer.$name=$;CropperViewer.$version="2.1.0";export{S as RESIZE_BOTH,p as RESIZE_HORIZONTAL,b as RESIZE_NONE,I as RESIZE_VERTICAL,CropperViewer as default};

